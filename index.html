<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Live Now - cricketlive.site</title>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.6.0/shaka-player.ui.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.6.0/controls.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <style>
    * { margin:0; padding:0; box-sizing:border-box }
    .player-wrap { overflow:hidden }

    .shaka-video-container {
      position:relative;
      width:100%;
      aspect-ratio:16/9;
      background:#000;
      overflow:hidden;
    }

    video, iframe { width:100%; height:100%; border:0 }

    .watermark-logo {
      position:absolute;
      top:55%;
      left:2.5%;
      z-index:9999;
      pointer-events:none;
    }

    .watermark-logo img { width:48px }

    .shaka-seek-bar {
      background:#C3C3C3 !important;
      border-radius:10px;
    }

    .shaka-seek-bar-container input[type="range"]::-webkit-slider-thumb {
      background:#2962ff !important;
    }
  </style>
</head>

<body>

<div class="player-wrap">
  <div class="shaka-video-container" id="playerBox">

    <div class="watermark-logo">
      <img src="https://i.postimg.cc/MTTS4nsH/createlive.png">
    </div>

    <video autoplay playsinline></video>
  </div>
</div>

<script>
const q = new URLSearchParams(location.search);
const streamUrl = q.get("url");
const keyId = q.get("keyId");
const key = q.get("key");

document.addEventListener("DOMContentLoaded", async () => {

  if (!streamUrl) {
    alert("Stream URL missing");
    return;
  }

  const box = document.getElementById("playerBox");
  const video = box.querySelector("video");

  video.muted = true;

  // CASE 1: HTML PLAYER
  if (streamUrl.includes(".html") || streamUrl.includes("player")) {
    box.innerHTML = `<iframe src="${streamUrl}" allowfullscreen allow="autoplay"></iframe>`;
    return;
  }

  // CASE 2: DIRECT STREAM
  if (!keyId && !key) {
    video.src = streamUrl;
    await video.play().catch(()=>{});
  }

  // CASE 3: DRM MPD
  if (keyId && key) {
    shaka.polyfill.installAll();
    if (!shaka.Player.isBrowserSupported()) return;

    const player = new shaka.Player(video);

    const ui = new shaka.ui.Overlay(player, box, video);

    // âœ… LANGUAGE SELECTOR ENABLE
    ui.configure({
      controlPanelElements: [
        'play_pause',
        'time_and_duration',
        'spacer',
        'mute',
        'volume',
        'language',
        'captions',
        'fullscreen'
      ]
    });

    player.configure({
      preferredAudioLanguage: 'hi',
      preferredTextLanguage: 'hi',
      drm: {
        clearKeys: { [keyId]: key }
      }
    });

    player.getNetworkingEngine().registerRequestFilter((t, r) => {
      r.headers["Referer"] = "https://www.jiotv.com/";
      r.headers["User-Agent"] = "ExoPlayer";
    });

    await player.load(streamUrl);
    await video.play().catch(()=>{});
  }

  // ðŸ”Š First tap = sound ON
  const enableSound = () => {
    video.muted = false;
    video.volume = 1;
    document.removeEventListener("click", enableSound);
    document.removeEventListener("touchstart", enableSound);
  };

  document.addEventListener("click", enableSound, { once:true });
  document.addEventListener("touchstart", enableSound, { once:true });

});
</script>

</body>
</html>
